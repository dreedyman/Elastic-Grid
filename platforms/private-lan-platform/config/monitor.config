/*
 * Configuration for a Provision Monitor
 */
import java.io.File;
import java.util.logging.ConsoleHandler;
import java.util.logging.Level;
import org.rioproject.core.ClassBundle;
import org.rioproject.log.LoggerConfig;
import org.rioproject.log.LoggerConfig.LogHandlerConfig;
import org.rioproject.fdh.FaultDetectionHandlerFactory;
import org.rioproject.monitor.DeployHandler;
import org.rioproject.monitor.FileSystemOARDeployHandler;
import com.elasticgrid.platforms.ec2.monitor.S3OARDeployHandler;
import com.elasticgrid.utils.amazon.AWSUtils;
import com.elasticgrid.platforms.ec2.config.EC2Configuration;

/* --------------------------------------------------------------------------
 * Declare Provision Monitor properties
 * --------------------------------------------------------------------------*/
org.rioproject.monitor {
    initialLookupGroups = new String[] { "rio" };
    serviceName = "Elastic Grid Monitor";
    serviceComment = "Elastic Grid Dynamic Provisioning Agent";
    jmxName = "com.elasticgrid.monitor:type=Monitor";

    //initialOpStrings = new String[]{"${RIO_HOME}/examples/calculator/deploy/calculator.xml" };

    loggerConfigs = new LoggerConfig[] {
        new LoggerConfig("org.rioproject.monitor",
                          Level.FINE,
                          false,
                          new LogHandlerConfig[] {
                              new LogHandlerConfig(new ConsoleHandler())
                          }),
        new LoggerConfig("org.rioproject.monitor.provision",
                          Level.FINEST,
                          false,
                          new LogHandlerConfig[] {
                              new LogHandlerConfig(new ConsoleHandler())
                          }),
        new LoggerConfig("org.rioproject.monitor.sbi",
                          Level.FINEST,
                          false,
                          new LogHandlerConfig[] {
                              new LogHandlerConfig(new ConsoleHandler())
                          }),
        new LoggerConfig("org.rioproject.monitor.peer",
                          Level.FINE,
                          false,
                          new LogHandlerConfig[] {
                              new LogHandlerConfig(new ConsoleHandler())
                          }),
        new LoggerConfig("net.jini.lookup.JoinManager", Level.OFF),
        new LoggerConfig("com.elasticgrid.platforms.ec2.monitor",
                          Level.FINE,
                          false,
                          new LogHandlerConfig[] {
                              new LogHandlerConfig(new ConsoleHandler())
                          })
    };

    /* Configure DeployHandlers for the Monitor to use */
    deployMonitorPeriod = 30000;
    deployDir = "${RIO_HOME}/deploy";
    deployHandlers = new DeployHandler[] {
                            new FileSystemOARDeployHandler(new File(deployDir)),
                            new S3OARDeployHandler(AWSUtils.getDropBucket(), new File(deployDir))
    };
    
    /* Configure a FaultDetectionHandler for the ProvisionMonitor */
    fdh = "org.rioproject.fdh.HeartbeatFaultDetectionHandler";
    configArg = new String[]{"-",
                             fdh+".heartbeatPeriod=10000",
                             fdh+".heartbeatGracePeriod=10000"
    };
    faultDetectionHandler =
        FaultDetectionHandlerFactory.getClassBundle(fdh, configArg);
}
